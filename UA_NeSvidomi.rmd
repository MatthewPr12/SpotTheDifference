---
title: "R Notebook"
output: html_notebook
authors: Sviatoslav Lushnei, Yaroslav Korch, Matvii Prytula
---

# Reading the data

```{r}
library(ggplot2)
library(reshape2)
```

```{r}
weekly_by_streams <- read.csv("joined_by_streams/joined_by_streams.csv")[, -1]
head(weekly_by_streams)
```

```{r}
weekly_by_quantity <- read.csv("joined_by_quantity/joined_by_quantity.csv")[, -1]
head(weekly_by_quantity)
```

### Plotting the data

```{r}
weekly_by_streams_perc = read.csv("joined_by_streams/joined_by_streams_perc.csv")
head(weekly_by_streams_perc)
```
### Plot the data
```{r}
plot_lang <- function(df, title){
  df <- melt(df , id.vars = 'week', variable.name = 'lang')
  ggplot(df, aes(week, value, group=lang)) + 
  scale_x_discrete(guide = guide_axis(check.overlap=TRUE))+
  theme(axis.text.x = element_text(angle = 90)) + 
  geom_point(aes(colour = lang)) + geom_line(aes(colour=lang)) + 
    labs(title = title) +
         geom_vline(xintercept=44,
                linetype=4, colour="black")
}
```

```{r}
plot_lang(weekly_by_quantity, "Quantities")
```

```{r}
plot_lang(weekly_by_streams, "Streams")
```

# Distribution of Ukrainian songs' rankings

Splitting the data-frame in 2 parts:

```{r}
before_war <- weekly_by_quantity[row.names(weekly_by_quantity) %in% 1:47, ]
after_war <- weekly_by_quantity[row.names(weekly_by_quantity) %in% 48:nrow(weekly_by_quantity), ]
```

Plotting the number of songs in Top 200:

```{r}
before_war_ua <- before_war[3] # UA songs

ggplot(before_war_ua, aes(x = UA)) +
geom_histogram(col="black", aes(y = after_stat(density))) +
geom_density(col = "red", size=1)



```

By looking at the plot one can assume that Ukrainian songs in Top 200 are geometrically distributed.

One can not check this using the Kolmogorov-Smirnov test since this is a discrete distribution rather than a continuous one. Instead, one can use a Chi-Square Goodness-of-Fit Test.

$$
H_0  - the \ data \ is \ drawn \ from \ a \ geometric \ distribution. \\
H_1 - not \ from \ a \ geometric \ distribution.
$$

To apply a Chi-Square test, expected probabilities have to be known. By finding the mean of the sample, one can estimate the parameter of the distribution.

```{r}
list_before_war_ua <- as.list(before_war_ua)$UA
parameter <- 1 / mean(list_before_war_ua)

p_val <- 0
for (i in 1:20){
  p_val <- p_val + chisq.test(list_before_war_ua, rgeom(length(list_before_war_ua), parameter), simulate.p.value = TRUE)$p.value
}
p_val <- p_val / 20
cat("The received p-value:", p_val, "\n")
```

As can be seen, one can not reject the Null hypothesis, yet as well as accept, since the p-value is not that large.
```{r}
plot_lang(weekly_by_streams_perc, "Streams percentage")
```
```{r}
ru_asymp = 0
perc_after_RU <- weekly_by_quantity$RU[weekly_by_streams_perc$week > "2022-02-24"]
ru_after_by_weeks <- (perc_after_RU - ru_asymp)
ru_after_by_weeks <- ru_after_by_weeks[ru_after_by_weeks>0]



X_ru <- (c(1:length(ru_after_by_weeks)))
Y_ru <- (ru_after_by_weeks)
ru_lmodel = lm(Y_ru ~ log(X_ru))
summary(ru_lmodel)
plot(c(1:length(ru_after_by_weeks)), ru_after_by_weeks)
```


```{r}
ua_asymp = 0
perc_after_UA <- weekly_by_streams$UA[weekly_by_streams_perc$week > "2022-02-24"]
ua_after_by_weeks <- (perc_after_UA - ua_asymp)
ua_after_by_weeks <- ua_after_by_weeks[ua_after_by_weeks>0]

plot(c(1:length(ua_after_by_weeks)), ua_after_by_weeks)

X_ua <- log(c(1:length(ua_after_by_weeks)))
Y_ua <- log(ua_after_by_weeks)
ua_lmodel = lm(X_ua ~ Y_ua)
summary(ua_lmodel)
```

```{r}
ua_corr_lmodel = lm(weekly_by_streams_perc$UA ~ weekly_by_quantity$UA)
summary(ua_corr_lmodel)
```
```{r}
ru_corr_lmodel = lm(weekly_by_streams_perc$RU ~ weekly_by_quantity$RU)
summary(ru_corr_lmodel)
```
```{r}
en_corr_lmodel = lm(weekly_by_streams_perc$EN ~ weekly_by_quantity$EN)
summary(en_corr_lmodel)
```

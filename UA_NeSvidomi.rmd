---
title: "R Notebook"
output: html_notebook
authors: Sviatoslav Lushnei, Yaroslav Korch, Matvii Prytula
---

# Task 1

### Reading data

```{r}
weekly_by_streams = read.csv("joined_by_streams/joined_by_streams.csv")
head(weekly_by_streams)
```

```{r}
weekly_by_quantity = read.csv("joined_by_quantity/joined_by_quantity.csv")
head(weekly_by_quantity)
```

### Plot the data

```{r}
library(ggplot2)
library(reshape2)

plot_lang <- function(df, title){
  df <- df[, -1]
  df <- melt(df , id.vars = 'week', variable.name = 'lang')
  ggplot(df, aes(week, value, group=lang)) + 
  scale_x_discrete(guide = guide_axis(check.overlap=TRUE))+
  theme(axis.text.x = element_text(angle = 90)) + 
  geom_point(aes(colour = lang)) + geom_line(aes(colour=lang)) + 
    labs(title = title) +
         geom_vline(xintercept=44,
                linetype=4, colour="black")
}
```

```{r}
plot_lang(weekly_by_quantity, "Quantities")
```

Type any R code in the chunk, for example:

```{r}
plot_lang(weekly_by_streams, "Streams")
```

# Task2

## Compare average time before the full-scale invasion and after

### Split the data

```{r}
quant_before = subset(weekly_by_quantity, week < "2022-02-24")
quant_after = subset(weekly_by_quantity, week >= "2022-02-24")

streams_before = subset(weekly_by_streams, week < "2022-02-24")
streams_after = subset(weekly_by_streams, week >= "2022-02-24")
```

We include **24.02.2022** into subset of those charts after the full-scale invasion because it started nearly 4:00 am, therefore, we suppose that Ukrainians did not listen that much music from 00:00 till 04:00

```{r}
UA_quant_before = quant_before["UA"]
EN_quant_before = quant_before["EN"]
RU_quant_before = quant_before["RU"]

UA_quant_after = quant_after["UA"]
EN_quant_after = quant_after["EN"]
RU_quant_after = quant_after["RU"]

UA_streams_before = streams_before["UA"]
EN_streams_before = streams_before["EN"]
RU_streams_before = streams_before["RU"]

UA_streams_after = streams_after["UA"]
EN_streams_after = streams_after["EN"]
RU_streams_after = streams_after["RU"]
```

#### UA

Since it is quite obvious, that Ukrainians started listening to Ukrainian music much more often, our hypothesis will look the following:\
$$H_0:\ \mu_0 = \mu_1$$\
where $\mu_0$ is the average number of Ukrainian songs in top-200 every week before the full-scale invasion. $\mu_1$ is the average number of Ukrainian songs in top-200 every week after the full-scale invasion. $$H_1:\ \mu_0 \lt \mu_1$$\

We use t-test to compare two populations' means. We make somewhat strong assumption that two populations are independent. We do so, as it is obvious that the music tastes of Ukrainians significantly changed after 24.02.2022.

Now we also suppose that variances of two populations are unequal and unknown

$$t = \frac{(\bar{x_0} - \bar{x_1}) - (\mu_0 - \mu_1)}{\sqrt{\frac{s_0^2}{n_0} + \frac{s_1^2}{n_1}}}$$

```{r}
t.test(as.numeric(unlist(UA_quant_before)), as.numeric(unlist(UA_quant_after)), mu=0, alt="less", conf.int = T, conf.level = 0.95)
```

P-value represents the probability to obtain such extreme difference in means, supposing $\mu_0$ is true. Here p-value is super small, which means that we reject our $H_0$, and the average number of Ukrainian songs before the full scale invasion is not equal to the number of Ukrainian songs after the full scale invasion $\mu0 \lt \mu_1$. It can even be seen from calculated means which are $\approx7.5$ and $\approx 52.7$ respectively. Or it is also obvious from the plotted data.

#### EN

For the number of English songs in top-200 Ukrainian charts it is not that obvious about how the tastes changed. So we will perform two-sided t-test, as our $H_0:\ \mu_0=\mu_1$ and $H_1:\ \mu_0 \neq \mu_1$\
$$T = \frac{\bar{x_0} - \bar{x_1}}{\sqrt{\frac{s_0^2}{n_0} + \frac{s_1^2}{n_1}}}$$ Then, we will reject our $H_0$ if $|T|\gt t_{1-\alpha/2, \nu}$ where $\nu$ represents degrees of freedom

```{r}
t.test(as.numeric(unlist(EN_quant_before)), as.numeric(unlist(EN_quant_after)), conf.int = T, conf.level = 0.95)
```

As we can see from the results of the t-test, p-value is much bigger than 0.05($\alpha$) so we do not reject the $H_0$. In other words, we cannot conclude that significant difference exists.

So the number of not Ukrainian and not russian songs in Ukrainian top-200 did not change much

#### RU

Numbers of russian songs in Ukrainian top-200 charts are rather scary. They changed to the smaller ones after the full-scale invasion(Hurray, what a surprise), but not that much.

We'll use one sided t-test(we do not know the variance) to test $H_0:\ \mu_0 = \mu_1$\
$H_a:\ \mu_0>\mu_1$ which is the same as saying $H_a:\ \mu_0-\mu_1<0$

The test statistic can be calculated:

$$t = \frac{(\bar{x_0} - \bar{x_1}) - (\mu_0 - \mu_1)}{\sqrt{\frac{s_0^2}{n_0} + \frac{s_1^2}{n_1}}}$$

```{r}
t.test(as.numeric(unlist(RU_quant_before)), as.numeric(unlist(RU_quant_after)), mu=0, alt="greater", conf.int = T, conf.level = 0.95)
```

Now, we see, that p-value is really small(close to 0), which means, that we should reject our $H_0$ about the equality of means. In other words, with in $\approx 0$ out of $100$ cases samples means will be equal.

And yeah, from the plot and calculated means, we see that the number of russian songs really became less. However, not much. :(
